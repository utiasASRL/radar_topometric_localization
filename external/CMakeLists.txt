cmake_minimum_required(VERSION 3.14)
project(VTR3-EXTERNAL)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(ExternalProject)
if (NOT CMAKE_BUILD_TYPE)
	set(CMAKE_BUILD_TYPE Release)
endif()

set(EXT_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/install/${CMAKE_BUILD_TYPE})
set(GLOBAL_RUNTIME_DIR ${CMAKE_CURRENT_SOURCE_DIR}/..)

# INSTALL CERES
ExternalProject_Add(
	Ceres
	PREFIX Ceres

	GIT_REPOSITORY  https://ceres-solver.googlesource.com/ceres-solver
	GIT_TAG 2.0.0

	BUILD_ALWAYS OFF
	INSTALL_DIR ${EXT_INSTALL_DIR}/Ceres
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX=${EXT_INSTALL_DIR}/Ceres
		-DBUILD_TESTING=OFF
		-DBUILD_EXAMPLES=OFF
		-DPROVIDE_UNINSTALL_TARGET=OFF
		-DCMAKE_CXX_STANDARD=${CMAKE_CXX_STANDARD}
		-DBUILD_SHARED_LIBS=ON

	BUILD_COMMAND     ${CMAKE_COMMAND} --build <BINARY_DIR> --config ${CMAKE_BUILD_TYPE} --target install --parallel 6
)

# INSTALL G2O
ExternalProject_Add(
	g2o
	PREFIX g2o

	GIT_REPOSITORY  https://github.com/RainerKuemmerle/g2o
	GIT_TAG 4736df5ca8ef258caa47ae0de9b59bc22fb80d1b

	BUILD_ALWAYS OFF
	INSTALL_DIR ${EXT_INSTALL_DIR}/g2o
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX=${EXT_INSTALL_DIR}/g2o
		-DCMAKE_CXX_STANDARD=${CMAKE_CXX_STANDARD}
    -DBUILD_WITH_MARCH_NATIVE=ON

	BUILD_COMMAND     ${CMAKE_COMMAND} --build <BINARY_DIR> --config ${CMAKE_BUILD_TYPE} --target install --parallel 6
)
